# Тестовое задание для ООО НПО Автомотив

- **тестировал на**: Linux server 6.12.41-gentoo x86_64 AMD Ryzen 7 5700G 32GB DDR4
- **Docker**: 28.0.4
- **Docker Compose**: v2.34.0
- **NodeJS**: 20.19.5
- **PostgreSQL**: 18.1

## Запуск Docker

docker compose up

### создание тестовых данных

docker compose exec app npm run seed

## Запуск node (linux bash)

cd ./frontend

npm install

npm run generate

**если нужно разделить фронтенд и бакенд, то не надо это выполнять.**

    сp -r ./dist/* ../backend/static     

cd ../backend

npm install

mv excample.env .env

_в .env изменить параметры подключения к БД_

npm install

npm run build

npm run seed

npm run start

**URL**: [http://localhost:3000]

## Оптимизация

### connection pool
#### Запросы: 100; задержка: 1 мс (3 попытки) 50000 строк.

Без настроек connection pool: 
Результат: 1) 16.895 сек. 2) 17.059 3) 16.992 сред.: 16.982 сек.

Настройки (app.modules.ts): 
```js
        extra: {
          max: 20, // максимальное количество соединений в пуле
          min: 5,  // минимальное количество соединений
          idleTimeoutMillis: 30000, // время неактивности перед закрытием
          connectionTimeoutMillis: 5000, // таймаут установки соединения
          acquireTimeoutMillis: 60000, // таймаут получения соединения из пула
        },
        cache: {
            duration: 30000,
        },
```
Результат: 1) 17.692 сек. 2) 17.694 3) 17.650 сред. : 17.678  сек.

Настройки: 
```js
        extra: {
          max: 2, // максимальное количество соединений в пуле
          min: 1,  // минимальное количество соединений
          idleTimeoutMillis: 30000, // время неактивности перед закрытием
          connectionTimeoutMillis: 5000, // таймаут установки соединения
          acquireTimeoutMillis: 60000, // таймаут получения соединения из пула
        },
        cache: {
            duration: 30000,
        },
```
Результат: 1) 17.197 сек. 2) 17.170 3) 17.854 сред. : 17.678  сек.


### Постраничный вывод

а) Параметры: запросов: 500, задержка: 1 мс, offset: 0,  limit: 100

Результат: 1) 03.763 сек. 2) 02.840 3) 02.789 сред. : 3.130  сек.


б) Параметры: запросов: 100, задержка: 1 мс, offset: 0,  limit: 500

Результат: 1) 01.079 сек. 2) 00.446 3) 00.862 сред. : 00.8795  сек.


в) Параметры: запросов: 50, задержка: 1 мс, offset: 0,  limit: 1000

Результат: 1) 01.789 сек. 2) 00.226 3) 00.862 сред. : 00.212  сек.


### Вывод: 
По скорости загрузки всех 50000, набор параметров в) при постраничной загрузке приблизился к скорости загрузки всех строк за 1 запрос.

Для полной картины не хватает запросов с диапазонами(between) с индексацией и без. Так же можно нагрузить например: JMeter.
